#!/bin/sh

if ! command -v docker &> /dev/null
then
  echo "Please install docker"
  exit 1
fi

if command -v git &> /dev/null
then
  echo "#####################"
  echo "# Update repository #"
  echo "#####################"
  echo ""

  git pull origin main
fi

echo "##################################"
echo "# Starting to build docker image #"
echo "##################################"
echo ""
docker build -t badgepad-latest .

echo "################################"
echo "# Starting to compile firmware #"
echo "################################"
echo ""
docker run -ti --rm -v $(pwd)/output:/build badgepad-latest
echo ""
echo "#############################################################"
echo "# Firmware compiled. Use QMKToolbox or dfu-util to flash it #"
echo "#############################################################"
